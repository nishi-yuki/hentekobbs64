<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>XSS</title>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/base-min.css">
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css"
        integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous">

    <script>
        function submitHandler(e) {
            var xmlHttp = new XMLHttpRequest();
            var inputtext = document.getElementById("inputtext");
            if (!inputtext.value) {
                console.log("emp")
                return
            }
            xmlHttp.onreadystatechange = function (e) {
                var commentarea = document.getElementById("commentsarea");
                // commentarea.textContent = xmlHttp.responseText; // 安全
                commentarea.innerHTML = xmlHttp.responseText; //危険! XSSされるよ
                console.log("rev")
            }
            // xmlHttp.open("GET", "/gettext?t=" + inputtext.value, true);
            // xmlHttp.send(null);
            xmlHttp.open("POST", "/postcomment", true);
            xmlHttp.send("t=" + encodeURIComponent(inputtext.value));
            console.log("send1")
            inputtext.value = "";
        }
    </script>

    <style type="text/css">
        .header {
            background: darkslateblue;
            color: floralwhite;
            margin: 0 0 0 0 !important;
            padding: 0.1rem;
        }

        .header h1 {
            margin: 0.2rem 1rem;
        }

        .mainui {
            margin: 2rem;
        }

        .mybutton {
            margin: 0.5rem 0.1rem;
        }

        #commentsarea {
            margin: 1rem 0;
        }
    </style>
</head>

<body>
    <div class="header pure-menu pure-menu-horizontal">
        <h1>XSS脆弱性</h1>
    </div>
    <div class="pure-g">
        <div class="pure-u-1-4"></div>
        <div class="pure-u-1-2 mainui">
            <form class="pure-form" id="send-comment" onsubmit="submitHandler(); return false">
                <input type="text" name="t" id="inputtext">
                <br>
                <div>
                    <!-- <input class="pure-button pure-button-primary mybutton" type="submit" value="POSTでおくるっ"> -->
                    <input class="pure-button pure-button-primary mybutton" type="button" value="ajaxでおくるっ"
                        onclick="submitHandler()">
                </div>
            </form>
            <div id="commentsarea">
                % for item in comments:
                <br>
                {{item}}
                % end
            </div>
        </div>
        <div class="pure-u-1-4"></div>
    </div>


</body>

</html>